From: Dima Kogan <dima@secretsauce.net>
Date: Sat, 24 May 2014 14:55:27 -0700
Subject: added configure option to disable libcairo
Forwarded: yes. merged upstream at https://github.com/simsong/tcpflow/commit/dcd8a9422f7919de17eb44d0f6f256b919df113b

---
 configure.ac | 43 +++++++++++++++++++++++++------------------
 1 file changed, 25 insertions(+), 18 deletions(-)

diff --git a/configure.ac b/configure.ac
index c6dab00..883cd9a 100644
--- a/configure.ac
+++ b/configure.ac
@@ -285,32 +285,39 @@ AC_LANG_POP()
 ################################################################
 # drawing support via cairo
 #
+cairo=test
+AC_ARG_ENABLE([cairo],[  --enable-cairo=false to disable libcairo even if present])
+  if test "${enable_cairo}" = false ; then
+    cairo=false
+  fi
 
-# Cairo requires these to be explicitly included on mingw (and perhaps others):
-AC_CHECK_LIB([expat],[XML_ParserCreate])
-AC_CHECK_LIB([pixman-1],[pixman_region_init])
-AC_CHECK_LIB([bz2],[BZ2_bzDecompress])
-AC_CHECK_LIB([freetype],[FT_Init_FreeType]) # requires bz2
-AC_CHECK_LIB([fontconfig],[FcBlanksCreate]) # requires freetype expat
+if test $cairo = test ; then
+  # Cairo requires these to be explicitly included on mingw (and perhaps others):
+  AC_CHECK_LIB([expat],[XML_ParserCreate])
+  AC_CHECK_LIB([pixman-1],[pixman_region_init])
+  AC_CHECK_LIB([bz2],[BZ2_bzDecompress])
+  AC_CHECK_LIB([freetype],[FT_Init_FreeType]) # requires bz2
+  AC_CHECK_LIB([fontconfig],[FcBlanksCreate]) # requires freetype expat
 
-AC_CHECK_HEADERS([cairo/cairo.h cairo/cairo-pdf.h])
-AC_CHECK_HEADERS([cairo.h cairo-pdf.h])
-AC_CHECK_LIB([cairo],[cairo_create], , [
-  AC_MSG_WARN([
-*** cairo libraries not detected.
-*** Please install cairo-devel to get 1-page PDF summary generation.
-])
-  Fmissing_library="cairo-devel $missing_library "
-  Umissing_library="libcairo2-dev $missing_library "
-  Mmissing_library="cairo-devel "
-])
+  AC_CHECK_HEADERS([cairo/cairo.h cairo/cairo-pdf.h])
+  AC_CHECK_HEADERS([cairo.h cairo-pdf.h])
+  AC_CHECK_LIB([cairo],[cairo_create], , [
+    AC_MSG_WARN([
+  *** cairo libraries not detected.
+  *** Please install cairo-devel to get 1-page PDF summary generation.
+  ])
+    Fmissing_library="cairo-devel $missing_library "
+    Umissing_library="libcairo2-dev $missing_library "
+    Mmissing_library="cairo-devel "
+  ])
+fi
 
 ################################################################
 # pcap support. A bit more involved than normal due to the error message
 #
 pcap=test
 AC_ARG_ENABLE([pcap],[  --enable-pcap=false to disable libpcap even if present])
-  if test "${enableval}" = false ; then
+  if test "${enable_pcap}" = false ; then
     pcap=false
   fi
 
